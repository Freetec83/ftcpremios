<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FTC Pr√™mios ‚Äî Rifa N¬∫001</title>
<style>
:root{
  --bg:#060607; --panel:#0f1013; --accent:#d4af37; --muted:#9aa4b2;
  --paid:#16c784; --reserved:#ffb84d; --text:#e6eef6;
}
body{margin:0;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif;background:#060607;color:var(--text);padding:18px}
.container{max-width:1150px;margin:0 auto}
header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.logo{height:56px;border-radius:8px}
h1{margin:0;font-size:20px}
.sub{color:var(--muted);font-size:13px}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
button{background:var(--accent);color:#061017;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;margin:18px 0}
.num{background:linear-gradient(180deg,#101217 0%,#0b0f14 100%);padding:10px;border-radius:8px;text-align:center;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.6);font-weight:700;border:1px solid rgba(255,255,255,0.02);color:var(--text)}
.num.reserved{background:linear-gradient(180deg,#3a2007,#4b2b09);color:#fff;cursor:not-allowed;border:1px solid rgba(0,0,0,0.4)}
.num.paid{background:linear-gradient(180deg,#06311f,#074228);color:#eafff0;cursor:not-allowed;border:1px solid rgba(0,0,0,0.4)}
.card{background:linear-gradient(180deg,#071018,#09121a);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.small{font-size:13px;color:var(--muted)}
.roleta-wrap{display:flex;align-items:center;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.roleta{width:360px;height:140px;background:radial-gradient(circle at 30% 10%, #2b0f00, #050609);border-radius:12px;color:var(--accent);display:flex;align-items:center;justify-content:center;font-size:46px;font-weight:900;letter-spacing:3px;box-shadow:0 10px 40px rgba(0,0,0,0.6);border:4px solid rgba(212,175,55,0.06)}
.footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
input,textarea{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);font-size:14px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <header>
    <img src="logo.jpg" alt="FTC Pr√™mios" class="logo" onerror="this.style.display='none'">
    <div>
      <h1>FTC Pr√™mios</h1>
      <div class="sub">Rifa N¬∫001 ‚Äî N√∫meros 00‚Äì99 ‚Ä¢ Valor: R$10,00 ‚Ä¢ Pr√™mio: <strong id="prizePercentText">70%</strong></div>
    </div>
  </header>

  <div class="actions">
    <button onclick="showReg()">üìú Regulamento</button>
    <button class="secondary" onclick="openAdmin()">üîê Organizador</button>
  </div>

  <div class="grid" id="grid"></div>

  <div class="roleta-wrap">
    <div class="roleta" id="roletaBox">--</div>
    <div style="display:flex;flex-direction:column;gap:8px">
      <button onclick="startRoleta()">‚ñ∂Ô∏è Iniciar roleta</button>
      <button class="secondary" onclick="stopRoleta()">‚èπÔ∏è Parar</button>
    </div>
  </div>

  <div class="footer">
    üîí Rifa privada simulada ‚Äî uso demonstrativo.
  </div>
</div>

<!-- Modal Regulamento -->
<div id="modalReg" class="modal" style="display:none">
  <div class="card" style="max-width:720px;width:94%">
    <h3>Regulamento</h3>
    <p class="small">
      Rifa N¬∫001 ‚Äî FTC Pr√™mios<br>
      ‚Ä¢ N√∫meros: 00‚Äì99 ‚Ä¢ Valor: R$10,00<br>
      ‚Ä¢ Pr√™mio: 70% do total arrecadado.<br>
      ‚Ä¢ Pagamento via grupo privado.<br>
      ‚Ä¢ Sorteio p√∫blico, vencedor registrado automaticamente.<br>
    </p>
    <div style="text-align:right;margin-top:8px"><button onclick="closeReg()">Fechar</button></div>
  </div>
</div>

<script>
const WEB_APP_URL='https://script.google.com/macros/s/AKfycbyKZOzLcYMTGCFVokdvdLw7xirI80swAM6tancoXbYlLcELxVOAQYMKcgT2r7WM52N1/exec';
const ADMIN_PASS='8378';
const PRIZE_PERCENT=0.7;
let sales=[]; 
let roletaInterval=null;

document.getElementById('prizePercentText').textContent=Math.round(PRIZE_PERCENT*100)+'%';

/* ---------- Fetch vendas do Apps Script ---------- */
async function fetchSales(){
  try{
    const res=await fetch(WEB_APP_URL);
    const data=await res.json();
    sales=data.items || data;
    renderGrid();
  }catch(e){ console.log('Erro fetch:',e); }
}

/* ---------- Render Grid ---------- */
function renderGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  for(let i=0;i<100;i++){
    const n=String(i).padStart(2,'0');
    const s=sales.find(x=>x.number===n);
    const el=document.createElement('div');
    el.className='num';
    el.textContent=n;
    if(s){
      el.classList.add(s.paid?'paid':'reserved');
      el.textContent+= s.paid?' ‚Ä¢ PAGO':' ‚Ä¢ RESERVADO';
    }
    grid.appendChild(el);
  }
}

/* ---------- Regulamento ---------- */
function showReg(){ document.getElementById('modalReg').style.display='flex'; }
function closeReg(){ document.getElementById('modalReg').style.display='none'; }

/* ---------- Organizador ---------- */
function openAdmin(){ 
  const p=prompt('Senha do organizador:'); 
  if(p!==ADMIN_PASS) return alert('Senha incorreta'); 
  alert('Acesso liberado'); 
}

/* ---------- Roleta ---------- */
function startRoleta(){
  const pool=sales.filter(s=>s.paid).map(s=>s.number);
  if(pool.length===0){ alert('Sem n√∫meros pagos.'); return; }
  const box=document.getElementById('roletaBox');
  const duration=30000;
  const startTime=Date.now();
  let lastPick='';
  
  function spin(){
    const elapsed=Date.now()-startTime;
    const t=elapsed/duration;
    if(t>=1){
      clearTimeout(roletaInterval);
      const winner=pool[Math.floor(Math.random()*pool.length)];
      box.textContent=winner;
      finalizeWinner(winner);
      return;
    }
    const speed=Math.max(30,50 + Math.floor(400*t*t)); 
    const pick=pool[Math.floor(Math.random()*pool.length)];
    if(pick!==lastPick){ box.textContent=pick; lastPick=pick; }
    roletaInterval=setTimeout(spin,speed);
  }
  spin();
}

function stopRoleta(){ clearTimeout(roletaInterval); }

async function finalizeWinner(number){
  alert('N√∫mero vencedor: '+number);
  const winner=sales.find(s=>s.number===number);
  if(!winner) return;
  try{
    await fetch(WEB_APP_URL,{
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({...winner,status:'Vencedor'})
    });
  }catch(e){ console.log('Erro registrar vencedor:',e); }
}

/* ---------- Init ---------- */
fetchSales();
setInterval(fetchSales,20000);
renderGrid();
</script>
</body>
</html>
