<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Rifa FTC Prêmios</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 20px; }
    h1 { color: #333; }
    form { background: #fff; padding: 15px; border-radius: 5px; max-width: 400px; }
    label { display: block; margin-top: 10px; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="password"] {
      width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;
    }
    button { margin-top: 15px; padding: 10px 20px; border: none; background-color: #007bff; color: white; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #mensagem { margin-top: 15px; font-weight: bold; }
    #painelOrganizador { margin-top: 30px; background: #fff; padding: 15px; border-radius: 5px; max-width: 600px; display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    tr.reservado { background-color: #fff8c4; }
    tr.pago { background-color: #b4ebc9; }
  </style>
</head>
<body>
  <h1>Rifa FTC Prêmios</h1>

  <form id="formReserva">
    <label for="nome">Nome:</label>
    <input id="nome" type="text" required />

    <label for="email">Email:</label>
    <input id="email" type="email" required />

    <label for="telefone">Telefone:</label>
    <input id="telefone" type="tel" required />

    <label for="numero">Número (00 a 99):</label>
    <input id="numero" type="number" min="0" max="99" required />

    <button type="submit">Reservar</button>
  </form>

  <div id="mensagem"></div>

  <h2>Painel do Organizador</h2>
  <input id="senha" type="password" placeholder="Digite a senha" />
  <button id="botaoLogin">Entrar</button>

  <div id="painelOrganizador">
    <h3>Controle da Rifa</h3>
    <button id="botaoSortear">Sortear Vencedor</button>
    <div id="resultadoSorteio"></div>

    <h4>Reservas e Pagamentos</h4>
    <table id="tabelaDados">
      <thead>
        <tr><th>Número</th><th>Status</th><th>Nome</th><th>Email</th><th>Telefone</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Envie a reserva para backend
    document.getElementById('formReserva').addEventListener('submit', function(e) {
      e.preventDefault();
      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const telefone = document.getElementById('telefone').value;
      let numero = document.getElementById('numero').value;
      numero = numero.padStart(2, '0'); // Preenche com zero à esquerda
      
      google.script.run.withSuccessHandler(res => {
        document.getElementById('mensagem').innerText = res.message;
        if (res.status === 'success'){
          document.getElementById('formReserva').reset();
        }
      }).reservarNumero({nome, email, telefone, numero});
    });

    // Login painel organizador
    document.getElementById('botaoLogin').addEventListener('click', function() {
      const senha = document.getElementById('senha').value;
      google.script.run.withSuccessHandler(valid => {
        if (valid) {
          document.getElementById('painelOrganizador').style.display = 'block';
          carregarDadosPainel();
        } else {
          alert('Senha incorreta.');
        }
      }).painelLogin(senha);
    });

    // Função para carregar dados no painel organizador
    function carregarDadosPainel() {
      google.script.run.withSuccessHandler(dados => {
        const tbody = document.querySelector('#tabelaDados tbody');
        tbody.innerHTML = '';
        dados.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td>`;
          tr.className = row[1].toLowerCase();
          tbody.appendChild(tr);
        });
      }).obterDadosPainel();
    }

    // Botão sortear vencedor
    document.getElementById('botaoSortear').addEventListener('click', function() {
      google.script.run.withSuccessHandler(res => {
        if (res.status === 'success') {
          document.getElementById('resultadoSorteio').innerText = 'Número Vencedor: ' + res.vencedor;
        } else {
          alert(res.message);
        }
      }).sortearVencedor();
    });
  </script>
</body>
</html>
