<!doctype html>

<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rifa — 00–99</title>
<style>
  :root{--accent:#0b74da;--sold:#d9534f;--reserved:#f0ad4e;--paid:#5cb85c}
  body{font-family:Arial,Helvetica,sans-serif;background:#f7f7f7;margin:0;padding:18px;color:#222}
  .container{max-width:1100px;margin:0 auto}
  header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
  header img.logo{height:56px}
  h1{font-size:20px;margin:0}
  .sub{color:#555;font-size:14px}
  .topright{margin-left:auto;text-align:right}
  .grid{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;margin:18px 0}
  .num{background:#fff;padding:12px;border-radius:8px;text-align:center;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,0.06);font-weight:700}
  .num.reserved{background:linear-gradient(90deg,#fff3e0,#fff7ed);color:#8a4b00;cursor:not-allowed}
  .num.paid{background:linear-gradient(90deg,#e8f7ea,#f3fff5);color:#1b5e20;cursor:not-allowed}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  button{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
  button.secondary{background:#ddd;color:#222}
  .card{background:#fff;padding:12px;border-radius:8px;margin-top:8px}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5)}
  label{display:block;margin-top:8px;font-size:14px}
  input{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:13px}
  .small{font-size:13px;color:#555}
  .badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#f2f2f2;font-weight:600}
  .stats{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .stat{background:#fff;padding:10px;border-radius:8px}
  @media(max-width:720px){.grid{grid-template-columns:repeat(5,1fr)}header{flex-direction:column;align-items:flex-start}}
  /* ===== admin hint ===== */
  .admin-hint{font-size:12px;color:#666;margin-top:6px}
</style>
</head>
<body>
  <div class="container">
    <header>
      <!-- Substitua logo.png abaixo pela URL do seu logo -->
      <img src="LOGO_IMAGE_URL" alt="Logo" class="logo" onerror="this.style.display='none'" />
      <div>
        <h1>Rifa — Números 00 a 99</h1>
        <div class="sub">Valor por número: <strong>R$10,00</strong> • Prêmio: <strong>40% do total arrecadado</strong></div>
      </div>
      <div class="topright">
        <div class="badge">PIX: <span id="pixKeyPreview">COLE_SUA_CHAVE_PIX_AQUI</span></div>
        <div class="small">QR code visível no site</div>
      </div>
    </header><div class="actions">
  <button onclick="showRegulamento()">Ver Regulamento</button>
  <button class="secondary" onclick="openAdmin()">Painel do Organizador</button>
  <button class="secondary" onclick="exportCSV()">Exportar CSV</button>
  <button onclick="openGroup()">Entrar no Grupo da Rifa</button>
  <button onclick="sortear()">Sortear Agora</button>
</div>

<div class="card stats">
  <div class="stat"><strong id="countReserved">0</strong> reservados</div>
  <div class="stat"><strong id="countPaid">0</strong> pagos</div>
  <div class="stat"><strong id="totalArrecadado">R$0,00</strong></div>
  <div class="stat"><strong id="prizeAmount">R$0,00</strong> (40%)</div>
</div>

<div style="margin-top:10px" class="card small">
  <!-- Substitua qr.png pela URL da imagem do QR Code do Pix -->
  <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
    <div>
      <img id="pixQR" src="PIX_QR_IMAGE_URL" alt="QR Code PIX" style="max-width:180px;border-radius:8px;display:block" onerror="this.style.display='none'" />
    </div>
    <div>
      <div><strong>Chave PIX:</strong> <span id="pixKeyText">COLE_SUA_CHAVE_PIX_AQUI</span></div>
      <div class="small">Ao pagar, entre no grupo e envie o comprovante. O organizador irá confirmar o pagamento.</div>
    </div>
  </div>
</div>

<div class="grid" id="grid"></div>

<div class="card" id="salesBox">
  <strong>Vendas / Reservas</strong>
  <div id="salesList" style="margin-top:10px">Nenhuma venda ainda.</div>
  <div class="admin-hint">Observação: "Reservado" significa que a pessoa indicou o número e deve pagar; o organizador confirma o pagamento e marca como <em>Pago</em>.</div>
</div>

<div class="card small" style="margin-top:12px;text-align:center;color:#555;font-size:13px">
  <strong>Aviso importante:</strong> Esta rifa é de caráter <strong>privado</strong> e sem fins lucrativos, restrita a participantes convidados. Ao participar, o usuário declara aceitar o regulamento.
</div>

  <!-- Modal: compra -->  <div id="modalBuy" class="modal" style="display:none">
    <div class="card" style="max-width:520px;width:94%">
      <h3>Reservar número <span id="modalNum"></span></h3>
      <label>Nome</label>
      <input id="buyerName" placeholder="Seu nome" />
      <label>Celular (com DDD, só números)</label>
      <input id="buyerPhone" placeholder="21999998888" />
      <div style="display:flex;gap:8px;margin-top:12px">
        <button onclick="confirmReserve()">Reservar e Mostrar PIX</button>
        <button class="secondary" onclick="closeBuy()">Cancelar</button>
      </div>
      <div id="afterReserve" style="margin-top:12px;display:none">
        <div class="small">Envie o PIX e depois entre no grupo para enviar o comprovante.</div>
        <div style="margin-top:8px">
          <button onclick="openGroup()">Entrar no Grupo (enviar comprovante)</button>
          <button class="secondary" onclick="copyPixKey()">Copiar chave PIX</button>
        </div>
      </div>
    </div>
  </div>  <!-- Modal: regulamento -->  <div id="modalReg" class="modal" style="display:none">
    <div class="card" style="max-width:720px;width:94%">
      <h3>Regulamento (resumido)</h3>
      <p class="small">
        1) Números: 00 a 99. • 2) Valor: R$10 por número. • 3) Prêmio: 40% do total arrecadado. • 4) Pagamento: PIX. • 5) Reservas são confirmadas pelo organizador após envio de comprovante. • 6) Sorteio: realizado publicamente no site assim que todos os números forem vendidos ou na data anunciada no grupo.
      </p>
      <div style="text-align:right;margin-top:8px"><button onclick="closeReg()">Fechar</button></div>
    </div>
  </div>  <!-- Modal: admin -->  <div id="modalAdmin" class="modal" style="display:none">
    <div class="card" style="max-width:720px;width:94%">
      <h3>Painel do Organizador</h3>
      <div class="small">Abaixo você pode confirmar pagamentos, cancelar reservas e exportar a lista.</div>
      <div style="margin-top:10px">
        <button onclick="markAllPaid()">Marcar todos como pagos</button>
        <button class="secondary" onclick="clearAll()">Limpar tudo (reset)</button>
      </div>
      <div style="margin-top:10px">
        <strong>Vendas</strong>
        <div id="adminSales" style="margin-top:8px"></div>
      </div>
      <div style="text-align:right;margin-top:8px"><button onclick="closeAdmin()">Fechar</button></div>
    </div>
  </div><script>
/* ================== CONFIGURE AQUI ==================
 - PIX_KEY: chave Pix exibida (telefone, email ou aleatória)
 - PIX_QR: url da imagem do QR Code (deixe vazia se não tiver)
 - GROUP_LINK: link do grupo do WhatsApp (chat.whatsapp.com/...) ou link de convite
 - PRICE: preço por número em centavos (1000 = R$10,00)
 - PRIZE_PERCENT: percentual do arrecadado que vai pro prêmio (0.4 = 40%)
 - LOGO_IMAGE: url do logo (substitui placeholder no topo)
 ==================================================== */
const PIX_KEY = 'COLE_SUA_CHAVE_PIX_AQUI';
const PIX_QR = 'PIX_QR_IMAGE_URL';
const GROUP_LINK = 'WHATSAPP_GROUP_LINK';
const PRICE = 1000; // centavos, R$10,00
const PRIZE_PERCENT = 0.40;
const LOGO_IMAGE = 'LOGO_IMAGE_URL';
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw2rWmBMR0LTZZCmxozw4Rji9PHfL-RA-Plor0a6g8Xf5njs8WWkqQiqHsRhG8pAmJM/exec';
/* ==================================================== */

// inicializa preview
if(LOGO_IMAGE){ document.querySelector('img.logo').src = LOGO_IMAGE; }
document.getElementById('pixKeyPreview').textContent = PIX_KEY;
document.getElementById('pixKeyText').textContent = PIX_KEY;
if(PIX_QR){ document.getElementById('pixQR').src = PIX_QR; } else { document.getElementById('pixQR').style.display='none'; }

const grid = document.getElementById('grid');
const salesKey = 'rifa_sales_00_99_v1';
let sales = JSON.parse(localStorage.getItem(salesKey) || '[]');

function renderGrid(){
  grid.innerHTML='';
  for(let i=0;i<100;i++){
    const n = String(i).padStart(2,'0');
    const el = document.createElement('div');
    el.className = 'num';
    el.textContent = n;
    const s = sales.find(x=>x.number===n);
    if(s){
      if(s.paid) el.classList.add('paid'); else el.classList.add('reserved');
      el.textContent = n + (s.paid ? ' • PAGO' : ' • RESERVADO');
    } else {
      el.onclick = ()=> openBuy(n);
    }
    grid.appendChild(el);
  }
  renderSales();
  updateStats();
}

function openBuy(n){
  document.getElementById('modalNum').textContent = n;
  document.getElementById('buyerName').value = '';
  document.getElementById('buyerPhone').value = '';
  document.getElementById('afterReserve').style.display='none';
  document.getElementById('modalBuy').style.display = 'flex';
  document.getElementById('modalBuy').dataset.sel = n;
}
function closeBuy(){ document.getElementById('modalBuy').style.display='none'; }

function confirmReserve(){
  const n = document.getElementById('modalBuy').dataset.sel;
  const name = document.getElementById('buyerName').value.trim();
  const phone = document.getElementById('buyerPhone').value.trim();
  if(!name || !phone) return alert('Preencha nome e celular.');
  const now = new Date().toISOString();
  const sale = { number: n, name, phone, date: now, paid: false };
  sales.push(sale);
  localStorage.setItem(salesKey, JSON.stringify(sales));
  renderGrid();
  document.getElementById('afterReserve').style.display='block';
}

function renderSales(){
  const box = document.getElementById('salesList');
  if(sales.length===0){ box.innerHTML='Nenhuma venda ainda.'; return; }
  let html = '<table><thead><tr><th>Nº</th><th>Nome</th><th>Celular</th><th>Data</th><th>Pago?</th></tr></thead><tbody>';
  sales.slice().reverse().forEach((s,idx)=>{
    html += `<tr><td>${s.number}</td><td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.phone)}</td><td>${new Date(s.date).toLocaleString()}</td><td>${s.paid? 'SIM' : 'NÃO'}</td></tr>`;
  });
  html += '</tbody></table>';
  box.innerHTML = html;
}

function updateStats(){
  const reserved = sales.length;
  const paid = sales.filter(s=>s.paid).length;
  const total = paid * PRICE / 100; // em reais
  const prize = total * PRIZE_PERCENT;
  document.getElementById('countReserved').textContent = reserved;
  document.getElementById('countPaid').textContent = paid;
  document.getElementById('totalArrecadado').textContent = formatMoney(total);
  document.getElementById('prizeAmount').textContent = formatMoney(prize);
}

function escapeHtml(s){ return String(s).replace(/[&<>"] /g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]||c)); }

function copyPixKey(){ navigator.clipboard.writeText(PIX_KEY).then(()=> alert('Chave PIX copiada para a área de transferência.')) }

function openGroup(){ if(!GROUP_LINK || GROUP_LINK.includes('WHATSAPP_GROUP_LINK')){ return alert('Link do grupo não configurado. Edite o código e substitua GROUP_LINK.'); } window.open(GROUP_LINK,'_blank'); }

/* ========== Admin ========== */
function openAdmin(){
  const pass = prompt('Senha do organizador:');
  // Senha simples: troque a checagem conforme preferir. Se deixar em branco, cancela.
  if(pass !== 'admin123') return alert('Senha incorreta ou não definida.');
  document.getElementById('modalAdmin').style.display='flex';
  renderAdminSales();
}
function closeAdmin(){ document.getElementById('modalAdmin').style.display='none'; }

function renderAdminSales(){
  const box = document.getElementById('adminSales');
  if(sales.length===0){ box.innerHTML='Nenhuma venda.'; return; }
  let html = '<table><thead><tr><th>Nº</th><th>Nome</th><th>Celular</th><th>Pago</th><th>Ações</th></tr></thead><tbody>';
  sales.forEach((s,idx)=>{
    html += `<tr><td>${s.number}</td><td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.phone)}</td><td>${s.paid? 'SIM' : 'NÃO'}</td><td>`+
            `<button onclick="confirmPaid(${idx})">Confirmar Pago</button> <button onclick="cancelSale(${idx})" class='secondary'>Cancelar</button></td></tr>`;
  });
  html += '</tbody></table>';
  box.innerHTML = html;
}

function confirmPaid(idx){
  sales[idx].paid = true;
  localStorage.setItem(salesKey, JSON.stringify(sales));
  renderGrid();
  renderAdminSales();
}
function cancelSale(idx){
  if(!confirm('Remover essa reserva?')) return;
  sales.splice(idx,1);
  localStorage.setItem(salesKey, JSON.stringify(sales));
  renderGrid();
  renderAdminSales();
}

function markAllPaid(){ if(!confirm('Marcar todas as reservas como pagas?')) return; sales.forEach(s=>s.paid=true); localStorage.setItem(salesKey, JSON.stringify(sales)); renderGrid(); renderAdminSales(); }
function clearAll(){ if(!confirm('Apagar todas as vendas e reservas?')) return; sales = []; localStorage.removeItem(salesKey); renderGrid(); renderAdminSales(); }

/* Export CSV */
function exportCSV(){ if(sales.length===0) return alert('Sem vendas para exportar.');
  const header = ['number','name','phone','date','paid'];
  const rows = [header.join(',')].concat(sales.map(s=>[s.number, quoteCsv(s.name), quoteCsv(s.phone), s.date, s.paid].join(',')));
  const csv = rows.join('\n');
  const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'vendas_rifa.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}
function quoteCsv(s){ return '"'+String(s).replace(/"/g,'""')+'"'; }

/* Sorteio: apenas entre números pagos (ou, se nenhum pago, entre reservados). */
function sortear(){
  const poolPaid = sales.filter(s=>s.paid).map(s=>s.number);
  const poolReserved = sales.filter(s=>!s.paid).map(s=>s.number);
  const pool = poolPaid.length? poolPaid : poolReserved;
  if(pool.length===0) return alert('Sem números para sortear.');
  // animação simples
  const winner = pool[Math.floor(Math.random()*pool.length)];
  if(confirm('Sortear agora? O vencedor exibido será definitivo (recomendado gravar).')){
    alert('Vencedor: ' + winner + '\nPublique o resultado no grupo e grave o sorteio.');
    // destacar vencedor na tela
    highlightWinner(winner);
  }
}
function highlightWinner(num){
  document.querySelectorAll('.num').forEach(el=>{
    if(el.dataset && el.dataset.num === num) el.style.boxShadow = '0 0 0 4px gold';
  });
}

function confirmReserveByIndex(idx){ /* helper if needed */ }

/* Utils e init */
function formatMoney(v){ return 'R$'+Number(v).toFixed(2).replace('.',','); }
function quoteCsv(s){ return '"'+String(s).replace(/"/g,'""')+'"'; }

renderGrid();

</script></body>
</html>
